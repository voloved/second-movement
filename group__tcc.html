<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Movement: Buzzer and LED Control (via the TCC peripheral)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Movement<span id="projectnumber">&#160;2.0.0</span>
   </div>
   <div id="projectbrief">The community firmware for Sensor Watch.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Topics</a> &#124;
<a href="#enumval-members">Enumerator</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">Buzzer and LED Control (via the TCC peripheral)</div></div>
</div><!--header-->
<div class="contents">

<p>This section covers functions related to Timer Counter for Control peripheral, which drives the piezo buzzer embedded in the F-91W's back plate as well as the LED that backlights the display.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Topics</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__led.html">LED Control</a></td></tr>
<tr class="memdesc:group__led"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section covers functions related to the bi-color red/green LED mounted behind the LCD. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga84d2f603c4f87f2199ebc102439fb204" id="r_ga84d2f603c4f87f2199ebc102439fb204"><td class="memItemLeft" align="right" valign="top"><a id="ga84d2f603c4f87f2199ebc102439fb204" name="ga84d2f603c4f87f2199ebc102439fb204"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>watch_enable_buzzer</b> (void)</td></tr>
<tr class="memdesc:ga84d2f603c4f87f2199ebc102439fb204"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enables the TCC peripheral, which drives the buzzer. <br /></td></tr>
<tr class="separator:ga84d2f603c4f87f2199ebc102439fb204"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga64cb6d242fa06bb1da4c34d8d0a2f138" id="r_ga64cb6d242fa06bb1da4c34d8d0a2f138"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga64cb6d242fa06bb1da4c34d8d0a2f138">watch_set_buzzer_period_and_duty_cycle</a> (uint32_t period, uint8_t duty)</td></tr>
<tr class="memdesc:ga64cb6d242fa06bb1da4c34d8d0a2f138"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the period of the buzzer.  <br /></td></tr>
<tr class="separator:ga64cb6d242fa06bb1da4c34d8d0a2f138"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga24cef76bc304371e7914c7c5bb579f93" id="r_ga24cef76bc304371e7914c7c5bb579f93"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga24cef76bc304371e7914c7c5bb579f93">watch_disable_buzzer</a> (void)</td></tr>
<tr class="memdesc:ga24cef76bc304371e7914c7c5bb579f93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disables the TCC peripheral that drives the buzzer.  <br /></td></tr>
<tr class="separator:ga24cef76bc304371e7914c7c5bb579f93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6a2d48712d70aff4a1ab463afe6fdd98" id="r_ga6a2d48712d70aff4a1ab463afe6fdd98"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6a2d48712d70aff4a1ab463afe6fdd98">watch_set_buzzer_on</a> (void)</td></tr>
<tr class="memdesc:ga6a2d48712d70aff4a1ab463afe6fdd98"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turns the buzzer output on. It will emit a continuous sound at the given frequency.  <br /></td></tr>
<tr class="separator:ga6a2d48712d70aff4a1ab463afe6fdd98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga803568f5bc5f6b77ea9efa5299c6d9f4" id="r_ga803568f5bc5f6b77ea9efa5299c6d9f4"><td class="memItemLeft" align="right" valign="top"><a id="ga803568f5bc5f6b77ea9efa5299c6d9f4" name="ga803568f5bc5f6b77ea9efa5299c6d9f4"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>watch_set_buzzer_off</b> (void)</td></tr>
<tr class="memdesc:ga803568f5bc5f6b77ea9efa5299c6d9f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turns the buzzer output off. <br /></td></tr>
<tr class="separator:ga803568f5bc5f6b77ea9efa5299c6d9f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7a8ad46027d5dfa669a2eb352d856484" id="r_ga7a8ad46027d5dfa669a2eb352d856484"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga7a8ad46027d5dfa669a2eb352d856484">watch_buzzer_play_note</a> (watch_buzzer_note_t note, uint16_t duration_ms)</td></tr>
<tr class="memdesc:ga7a8ad46027d5dfa669a2eb352d856484"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plays the given note for a set duration at the loudest possible volume.  <br /></td></tr>
<tr class="separator:ga7a8ad46027d5dfa669a2eb352d856484"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2fc6ba6485610e19205c9eb98fac6865" id="r_ga2fc6ba6485610e19205c9eb98fac6865"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2fc6ba6485610e19205c9eb98fac6865">watch_buzzer_play_note_with_volume</a> (watch_buzzer_note_t note, uint16_t duration_ms, watch_buzzer_volume_t volume)</td></tr>
<tr class="memdesc:ga2fc6ba6485610e19205c9eb98fac6865"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plays the given note for a set duration.  <br /></td></tr>
<tr class="separator:ga2fc6ba6485610e19205c9eb98fac6865"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga73713e47359708ef8eae50e8a505bf4b" id="r_ga73713e47359708ef8eae50e8a505bf4b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga73713e47359708ef8eae50e8a505bf4b">watch_buzzer_play_sequence</a> (int8_t *note_sequence, void(*callback_on_end)(void))</td></tr>
<tr class="memdesc:ga73713e47359708ef8eae50e8a505bf4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plays the given sequence of notes in a non-blocking way.  <br /></td></tr>
<tr class="separator:ga73713e47359708ef8eae50e8a505bf4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga73e7868fa41359376c9c4f9fd33aed7a" id="r_ga73e7868fa41359376c9c4f9fd33aed7a"><td class="memItemLeft" align="right" valign="top"><a id="ga73e7868fa41359376c9c4f9fd33aed7a" name="ga73e7868fa41359376c9c4f9fd33aed7a"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>watch_buzzer_abort_sequence</b> (void)</td></tr>
<tr class="memdesc:ga73e7868fa41359376c9c4f9fd33aed7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aborts a playing sequence. <br /></td></tr>
<tr class="separator:ga73e7868fa41359376c9c4f9fd33aed7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9e56a8a1f9234bbfbb75bb8c9bc0e749" id="r_ga9e56a8a1f9234bbfbb75bb8c9bc0e749"><td class="memItemLeft" align="right" valign="top"><a id="ga9e56a8a1f9234bbfbb75bb8c9bc0e749" name="ga9e56a8a1f9234bbfbb75bb8c9bc0e749"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>irq_handler_tc0</b> (void)</td></tr>
<tr class="separator:ga9e56a8a1f9234bbfbb75bb8c9bc0e749"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga747b4014093d6a71b6d8fba2db41696b" id="r_ga747b4014093d6a71b6d8fba2db41696b"><td class="memItemLeft" align="right" valign="top"><a id="ga747b4014093d6a71b6d8fba2db41696b" name="ga747b4014093d6a71b6d8fba2db41696b"></a>
const uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>NotePeriods</b> [108]</td></tr>
<tr class="memdesc:ga747b4014093d6a71b6d8fba2db41696b"><td class="mdescLeft">&#160;</td><td class="mdescRight">An array of periods for all the notes on a piano, corresponding to the names in watch_buzzer_note_t. <br /></td></tr>
<tr class="separator:ga747b4014093d6a71b6d8fba2db41696b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This section covers functions related to Timer Counter for Control peripheral, which drives the piezo buzzer embedded in the F-91W's back plate as well as the LED that backlights the display. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga7a8ad46027d5dfa669a2eb352d856484" name="ga7a8ad46027d5dfa669a2eb352d856484"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7a8ad46027d5dfa669a2eb352d856484">&#9670;&#160;</a></span>watch_buzzer_play_note()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void watch_buzzer_play_note </td>
          <td>(</td>
          <td class="paramtype">watch_buzzer_note_t</td>          <td class="paramname"><span class="paramname"><em>note</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>duration_ms</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plays the given note for a set duration at the loudest possible volume. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">note</td><td>The note you wish to play, or BUZZER_NOTE_REST to disable output for the given duration. </td></tr>
    <tr><td class="paramname">duration_ms</td><td>The duration of the note. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Note that this will block your UI for the duration of the note's play time, and it will after this call, the buzzer period will be set to the period of this note. </dd></dl>

</div>
</div>
<a id="ga2fc6ba6485610e19205c9eb98fac6865" name="ga2fc6ba6485610e19205c9eb98fac6865"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2fc6ba6485610e19205c9eb98fac6865">&#9670;&#160;</a></span>watch_buzzer_play_note_with_volume()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void watch_buzzer_play_note_with_volume </td>
          <td>(</td>
          <td class="paramtype">watch_buzzer_note_t</td>          <td class="paramname"><span class="paramname"><em>note</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>duration_ms</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">watch_buzzer_volume_t</td>          <td class="paramname"><span class="paramname"><em>volume</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plays the given note for a set duration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">note</td><td>The note you wish to play, or BUZZER_NOTE_REST to disable output for the given duration. </td></tr>
    <tr><td class="paramname">duration_ms</td><td>The duration of the note. </td></tr>
    <tr><td class="paramname">volume</td><td>either WATCH_BUZZER_VOLUME_SOFT or WATCH_BUZZER_VOLUME_LOUD </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This will block your UI for the duration of the note's play time, and after this call, the buzzer will stop sounding, but the TCC period will remain set to the period of this note. </dd></dl>

</div>
</div>
<a id="ga73713e47359708ef8eae50e8a505bf4b" name="ga73713e47359708ef8eae50e8a505bf4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga73713e47359708ef8eae50e8a505bf4b">&#9670;&#160;</a></span>watch_buzzer_play_sequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void watch_buzzer_play_sequence </td>
          <td>(</td>
          <td class="paramtype">int8_t *</td>          <td class="paramname"><span class="paramname"><em>note_sequence</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*</td>          <td class="paramname"><span class="paramname"><em>callback_on_end&#160;</em></span>)(void)&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plays the given sequence of notes in a non-blocking way. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">note_sequence</td><td>A pointer to the sequence of buzzer note &amp; duration tuples, ending with a zero. A simple RLE logic is implemented: a negative number instead of a buzzer note means that the sequence is rewound by the given number of notes. The byte following a negative number determines the number of loops. I.e. if you want to repeat the last three notes of the sequence one time, you should provide the tuple -3, 1. The repeated notes must not contain any other repeat markers, or you will end up with an eternal loop. </td></tr>
    <tr><td class="paramname">callback_on_end</td><td>A pointer to a callback function to be invoked when the sequence has finished playing. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function plays the sequence asynchronously, so the UI will not be blocked. Hint: It is not possible to play the lowest note BUZZER_NOTE_A1 (55.00 Hz). The note is represented by a zero byte, which is used here as the end-of-sequence marker. But hey, a frequency that low cannot be played properly by the watch's buzzer, anyway. </dd></dl>

</div>
</div>
<a id="ga24cef76bc304371e7914c7c5bb579f93" name="ga24cef76bc304371e7914c7c5bb579f93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga24cef76bc304371e7914c7c5bb579f93">&#9670;&#160;</a></span>watch_disable_buzzer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void watch_disable_buzzer </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disables the TCC peripheral that drives the buzzer. </p>
<dl class="section note"><dt>Note</dt><dd>If you are using PWM to set custom LED colors, this method will also disable the LED PWM driver, since the buzzer and LED both make use of the same peripheral to drive their PWM behavior. </dd></dl>

</div>
</div>
<a id="ga6a2d48712d70aff4a1ab463afe6fdd98" name="ga6a2d48712d70aff4a1ab463afe6fdd98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6a2d48712d70aff4a1ab463afe6fdd98">&#9670;&#160;</a></span>watch_set_buzzer_on()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void watch_set_buzzer_on </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turns the buzzer output on. It will emit a continuous sound at the given frequency. </p>
<dl class="section note"><dt>Note</dt><dd>The TCC peripheral that drives the buzzer does not run in standby mode; if you wish for buzzer output to continue, you should prevent your app from going to sleep. </dd></dl>

</div>
</div>
<a id="ga64cb6d242fa06bb1da4c34d8d0a2f138" name="ga64cb6d242fa06bb1da4c34d8d0a2f138"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga64cb6d242fa06bb1da4c34d8d0a2f138">&#9670;&#160;</a></span>watch_set_buzzer_period_and_duty_cycle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void watch_set_buzzer_period_and_duty_cycle </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>period</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>duty</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the period of the buzzer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">period</td><td>The period of a single cycle for the TCC peripheral. You can determine the period for a desired frequency with the following formula: period = 1000000 / freq </td></tr>
    <tr><td class="paramname">duty</td><td>The duty cycle of the buzzer, from 0 to 50 (percent ON time). Do not use values over 50. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Unless you <em>really</em> know what you're doing, use 25% for the duty cycle. If you're just aiming to play a tone at a given volume, use watch_buzzer_play_note_with_volume instead. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
